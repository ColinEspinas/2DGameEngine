"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,s,i,n,r=e(require("two.js")),a=e(require("shortid"));class h{constructor(){this.id=a.generate(),this.entities=[]}get GetId(){return this.id}Load(){for(var e=0,t=this.entities.length;e<t;e++)this.entities[e].Init()}Unload(){this.entities=[]}Render(){for(var e=0,t=this.entities.length;e<t;e++)this.entities[e].Update()}}class o{constructor(){this.scenes=[]}static get instance(){return o._instance||(o._instance=new o),o._instance}get GetScenes(){return this.scenes}AddScene(e,t){t&&t>=0?this.scenes.splice(t,0,e):this.scenes.push(e)}RemoveScene(e){this.scenes.splice(e,1)}Load(e){this.loadedScene&&this.loadedScene.Unload(),this.loadedScene=this.scenes[e],this.scenes[e].Load()}RenderLoadedScene(){this.loadedScene.Render()}}class c{constructor(){}static get instance(){return c._instance||(c._instance=new c),c._instance}static SetContext(e){c.driver=e}static GetContext(){return c.driver}}class u{constructor(){u.lastUpdate=0,u.deltaTime=0,u.fps=0}static get instance(){return u._instance||(u._instance=new u),u._instance}static DeltaTime(){return this.deltaTime}static LastUpdate(){return this.lastUpdate}static Fps(){return this.fps}static Update(){this.deltaTime=(performance.now()-this.lastUpdate)/1e3,this.lastUpdate=performance.now(),this.fps=1/this.deltaTime}}class d{constructor(e,t,s){this.x=e,this.y=t,s&&(this.z=s)}Equals(e,t){return null==t&&(t=1e-7),Math.abs(e.x-this.x)<=t&&Math.abs(e.y-this.y)<=t&&Math.abs(e.z-this.z)<=t}Add(e){return this.x+=e.x,this.y+=e.y,this.z&&(this.z+=e.z),this}Sub(e){return this.x-=e.x,this.y-=e.y,this.z&&(this.z-=e.z),this}Scale(e){return this.x*=e,this.y*=e,this.z&&(this.z*=e),this}Distance(e){var t=e.x-this.x,s=e.y-this.y,i=e.z-this.z;return i?Math.sqrt(t*t+s*s+i*i):Math.sqrt(t*t+s*s)}SquareDistance(e){var t=e.x-this.x,s=e.y-this.y,i=e.z-this.z;return i?t*t+s*s+i*i:t*t+s*s}SimpleDistance(e){var t=Math.abs(e.x-this.x),s=Math.abs(e.y-this.y),i=Math.abs(e.z-this.z);return i?Math.min(t,s,i):Math.min(t,s)}Dot(e){return this.z?this.x*e.x+this.y*e.y+this.z*e.z:this.x*e.x+this.y*e.y}Cross(e){var t=this.x,s=this.y,i=this.z,n=e.x,r=e.y,a=e.z;return this.x=s*a-i*r,this.y=i*n-t*a,this.z=t*r-s*n,this}Length(){return this.z?Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z):Math.sqrt(this.x*this.x+this.y*this.y)}Normalize(){var e=this.Length();return e>0&&this.Scale(1/e),this}Limit(e){var t=this.Length();return t>e&&t>0&&this.Scale(e/t),this}Lerp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this}ToString(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+", "+Math.floor(1e3*this.z)/1e3+"}"}static Zero(){return new d(0,0,0)}static One(){return new d(1,1,1)}static Up(){return new d(0,-1,0)}static Down(){return new d(0,1,0)}static Left(){return new d(-1,0,0)}static Right(){return new d(1,0,0)}static Front(){return new d(0,0,1)}static Back(){return new d(0,0,-1)}}d.FromArray=function(e){return new d(e[0],e[1],e[2])};class l{constructor(){}static get instance(){return l._instance||(l._instance=new l),l._instance}Init(e){this.containerElement=document.querySelector(e),this.containerElement.addEventListener("keydown",e=>{l.down[e.keyCode]=!0,e.repeat||(l.pressed[e.keyCode]=!0)}),this.containerElement.addEventListener("keyup",e=>{l.down[e.keyCode]=!1,l.released[e.keyCode]=!0}),this.containerElement.addEventListener("mousemove",e=>{l.mousePos.x=e.clientX,l.mousePos.y=e.clientY}),this.containerElement.addEventListener("mousedown",e=>{l.mouseDown[e.button]=!0,l.mousePressed[e.button]=!0}),this.containerElement.addEventListener("mouseup",e=>{l.mouseDown[e.button]=!1,l.mouseReleased[e.button]=!0}),this.containerElement.addEventListener("wheel",e=>{l.mouseWheel.x+=e.deltaX,l.mouseWheel.y+=e.deltaY,l.mouseWheel.z+=e.deltaZ})}Update(){for(var e=0,t=Object.keys(l.pressed).length;e<t;e++)l.pressed[Object.keys(l.pressed)[e]]=!1;for(e=0,t=Object.keys(l.released).length;e<t;e++)l.released[Object.keys(l.released)[e]]=!1;for(e=0,t=Object.keys(l.mouseReleased).length;e<t;e++)l.mouseReleased[Object.keys(l.mouseReleased)[e]]=!1}static GetKeyDown(e){return this.down[e]}static GetMousePosition(){return this.mousePos}static GetMouseDown(e){return this.mouseDown[e]}static GetMouseReleased(e){return this.mouseReleased[e]}static GetMouseWheel(){return this.mouseWheel}static SetCursor(e){this.instance.containerElement.style.cursor=e}static GetKeyPressed(e){return this.pressed[e]}static GetKeyReleased(e){return this.released[e]}}l.pressed={},l.down={},l.released={},l.mousePressed={},l.mouseDown={},l.mouseReleased={},l.mousePos=new d(0,0),l.mouseWheel=new d(0,0,0),(t=exports.Cursor||(exports.Cursor={})).Hidden="none",t.Default="default",t.Pointer="pointer",t.Help="help",t.Loading="wait",t.Crosshair="crosshair",t.Grab="grab",t.Grabbing="grabbing",t.NotAllowed="not-allowed",(s=exports.Mouse||(exports.Mouse={}))[s.Left=0]="Left",s[s.Middle=1]="Middle",s[s.Right=2]="Right",(i=exports.Key||(exports.Key={}))[i.Backspace=8]="Backspace",i[i.Tab=9]="Tab",i[i.Enter=13]="Enter",i[i.Shift=16]="Shift",i[i.Ctrl=17]="Ctrl",i[i.Alt=18]="Alt",i[i.PauseBreak=19]="PauseBreak",i[i.CapsLock=20]="CapsLock",i[i.Escape=27]="Escape",i[i.Space=32]="Space",i[i.PageUp=33]="PageUp",i[i.PageDown=34]="PageDown",i[i.End=35]="End",i[i.Home=36]="Home",i[i.LeftArrow=37]="LeftArrow",i[i.UpArrow=38]="UpArrow",i[i.RightArrow=39]="RightArrow",i[i.DownArrow=40]="DownArrow",i[i.Insert=45]="Insert",i[i.Delete=46]="Delete",i[i.Zero=48]="Zero",i[i.ClosedParen=48]="ClosedParen",i[i.One=49]="One",i[i.ExclamationMark=49]="ExclamationMark",i[i.Two=50]="Two",i[i.AtSign=50]="AtSign",i[i.Three=51]="Three",i[i.PoundSign=51]="PoundSign",i[i.Hash=51]="Hash",i[i.Four=52]="Four",i[i.DollarSign=52]="DollarSign",i[i.Five=53]="Five",i[i.PercentSign=53]="PercentSign",i[i.Six=54]="Six",i[i.Caret=54]="Caret",i[i.Hat=54]="Hat",i[i.Seven=55]="Seven",i[i.Ampersand=55]="Ampersand",i[i.Eight=56]="Eight",i[i.Star=56]="Star",i[i.Asterik=56]="Asterik",i[i.Nine=57]="Nine",i[i.OpenParen=57]="OpenParen",i[i.A=65]="A",i[i.B=66]="B",i[i.C=67]="C",i[i.D=68]="D",i[i.E=69]="E",i[i.F=70]="F",i[i.G=71]="G",i[i.H=72]="H",i[i.I=73]="I",i[i.J=74]="J",i[i.K=75]="K",i[i.L=76]="L",i[i.M=77]="M",i[i.N=78]="N",i[i.O=79]="O",i[i.P=80]="P",i[i.Q=81]="Q",i[i.R=82]="R",i[i.S=83]="S",i[i.T=84]="T",i[i.U=85]="U",i[i.V=86]="V",i[i.W=87]="W",i[i.X=88]="X",i[i.Y=89]="Y",i[i.Z=90]="Z",i[i.LeftWindowKey=91]="LeftWindowKey",i[i.RightWindowKey=92]="RightWindowKey",i[i.SelectKey=93]="SelectKey",i[i.Numpad0=96]="Numpad0",i[i.Numpad1=97]="Numpad1",i[i.Numpad2=98]="Numpad2",i[i.Numpad3=99]="Numpad3",i[i.Numpad4=100]="Numpad4",i[i.Numpad5=101]="Numpad5",i[i.Numpad6=102]="Numpad6",i[i.Numpad7=103]="Numpad7",i[i.Numpad8=104]="Numpad8",i[i.Numpad9=105]="Numpad9",i[i.Multiply=106]="Multiply",i[i.Add=107]="Add",i[i.Subtract=109]="Subtract",i[i.DecimalPoint=110]="DecimalPoint",i[i.Divide=111]="Divide",i[i.F1=112]="F1",i[i.F2=113]="F2",i[i.F3=114]="F3",i[i.F4=115]="F4",i[i.F5=116]="F5",i[i.F6=117]="F6",i[i.F7=118]="F7",i[i.F8=119]="F8",i[i.F9=120]="F9",i[i.F10=121]="F10",i[i.F11=122]="F11",i[i.F12=123]="F12",i[i.NumLock=144]="NumLock",i[i.ScrollLock=145]="ScrollLock",i[i.SemiColon=186]="SemiColon",i[i.Equals=187]="Equals",i[i.Comma=188]="Comma",i[i.Dash=189]="Dash",i[i.Period=190]="Period",i[i.UnderScore=189]="UnderScore",i[i.PlusSign=187]="PlusSign",i[i.ForwardSlash=191]="ForwardSlash",i[i.Tilde=192]="Tilde",i[i.GraveAccent=192]="GraveAccent",i[i.OpenBracket=219]="OpenBracket",i[i.ClosedBracket=221]="ClosedBracket",i[i.Quote=222]="Quote";class p{constructor(){this.position=new d(0,0,0),this.rotation=0,this.scale=new d(1,1)}}class m{constructor(e){this.parent=e}get name(){return this._name}}(n=exports.SpriteMode||(exports.SpriteMode={}))[n.BestFit=0]="BestFit",n[n.Cover=1]="Cover",n[n.Stretch=2]="Stretch",n[n.Unscaled=3]="Unscaled",exports.Component=m,exports.DrawManager=c,exports.Engine=class{constructor(e={}){e=Object.assign({scenes:[],width:1280,height:720,fullscreen:!1,container:"body"},e),this.sceneManager=o.instance,this.drawManager=c.instance,this.inputManager=l.instance;for(var t=0,s=e.scenes.length;t<s;t++)this.sceneManager.AddScene(e.scenes[t]);if(this.width=e.width,this.height=e.height,this.fullscreen=e.fullscreen,this.container=e.container,e.scenes.length<=0){let e=new h;this.sceneManager.AddScene(e)}}Run(){return c.SetContext(new r({width:this.width,height:this.height,fullscreen:this.fullscreen,autostart:!1,type:r.Types.webgl}).appendTo(document.querySelector(this.container))),this.inputManager.Init(this.container),console.log("Engine is running in ",document.querySelector(this.container)),this.sceneManager.Load(0),requestAnimationFrame(this.Update.bind(this)),0}Update(){u.Update(),this.sceneManager.RenderLoadedScene(),c.GetContext().update(),this.inputManager.Update(),requestAnimationFrame(this.Update.bind(this))}},exports.Entity=class{constructor(){this.id=a.generate(),this.transform=new p,this.components=[]}get GetId(){return this.id}Init(){for(var e=0,t=this.components.length;e<t;e++)this.components[e].Init()}Update(){for(var e=0,t=this.components.length;e<t;e++)this.components[e].Update()}AddComponent(e,...t){return this.components.push(new e(this,t)),this.components[this.components.length-1]}GetComponent(e){for(var t=0,s=this.components.length;t<s;t++)if(this.components[t].name===new e(this).name)return this.components[t]}GetComponents(e){let t=[];for(var s=0,i=this.components.length;s<i;s++)this.components[s].name===new e(this).name&&t.push(this.components[s]);return t}RemoveComponent(e){for(var t=0,s=this.components.length;t<s;t++)this.components[t].name===new e(this).name&&this.components.splice(t,1)}},exports.InputManager=l,exports.Scene=h,exports.SceneManager=o,exports.SpriteRenderer=class extends m{constructor(e,t=[]){super(e),this._name="SpriteRenderer",this.isFirstUpdate=!1,this.image=t[0],this.scale=1,this.stretchMode=t[1]}Init(){console.log(c.instance),this.texture=new r.Texture(this.image),this.shape=c.GetContext().makeRectangle(this.parent.transform.position.x,this.parent.transform.position.y,this.parent.transform.scale.x,this.parent.transform.scale.y),this.shape.noStroke(),this.shape.fill=this.texture}Update(){switch(this.shape.width=this.parent.transform.scale.x,this.shape.height=this.parent.transform.scale.y,this.stretchMode){case 0:{let e=this.texture.image.naturalWidth/this.texture.image.naturalHeight;this.texture.scale=e<1?new r.Vector(this.scale*(this.shape.height/this.texture.image.naturalHeight),this.scale*(this.shape.height/this.texture.image.naturalHeight)):new r.Vector(this.scale*(this.shape.width/this.texture.image.naturalWidth),this.scale*(this.shape.width/this.texture.image.naturalWidth));break}case 1:{let e=this.texture.image.naturalWidth/this.texture.image.naturalHeight;this.texture.scale=e<1?new r.Vector(this.scale*(this.shape.width/this.texture.image.naturalWidth),this.scale*(this.shape.width/this.texture.image.naturalWidth)):new r.Vector(this.scale*(this.shape.height/this.texture.image.naturalHeight),this.scale*(this.shape.height/this.texture.image.naturalHeight));break}case 2:this.texture.scale=new r.Vector(this.scale*(this.shape.width/this.texture.image.naturalWidth),this.scale*(this.shape.height/this.texture.image.naturalHeight))}this.shape.translation.set(this.parent.transform.position.x,this.parent.transform.position.y)}},exports.TimeManager=u,exports.Transform=p,exports.Vec=d;
